<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI PR Risk Gate</title>
    <link rel="stylesheet" href="/theme.css" />
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=Cormorant+Garamond:wght@500;600&display=swap');
      body { font-family: Manrope, system-ui, sans-serif; margin: 0; background: var(--bg); color: var(--text); }
      .wrap { max-width: 920px; margin: 40px auto; padding: 0 24px; }
      .nav { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:16px; }
      .nav a { text-decoration:none; color:var(--text); border:1px solid var(--line); background:var(--card); padding:8px 12px; border-radius:999px; font-size:12px; letter-spacing:.04em; text-transform:uppercase; }
      .nav a.active { background:var(--accent); color:#fff; border-color:var(--accent); }
      .card { background: var(--card); border: 1px solid var(--line); border-radius: 14px; padding: 24px; margin-bottom: 16px; box-shadow: 0 8px 22px rgba(31, 26, 23, .06); }
      h1 { margin: 0 0 8px 0; font-family: "Cormorant Garamond", Georgia, serif; letter-spacing: .2px; font-size: 2.15rem; line-height: 1.15; }
      p { color: var(--muted); line-height: 1.6; margin: 0; }
      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
      label { display: block; font-size: 12px; color: var(--muted); margin: 12px 0 6px; text-transform: uppercase; letter-spacing: .06em; }
      input, textarea { width: 100%; box-sizing: border-box; border-radius: 8px; border: 1px solid var(--line); background: #fff; color: var(--text); padding: 12px; font-size: 14px; }
      textarea { min-height: 136px; resize: vertical; }
      button { margin-top: 16px; border: 0; border-radius: 9px; padding: 11px 16px; background: var(--accent); color: #fff; font-weight: 600; letter-spacing:.02em; cursor: pointer; }
      .pill { display: inline-block; border-radius: 999px; padding: 4px 10px; font-size: 12px; font-weight: 700; }
      .low { background: var(--good-bg); color: var(--good); border: 1px solid #cfe4d7; }
      .medium { background: var(--warn-bg); color: var(--warn); border: 1px solid #eddcc6; }
      .high, .critical { background: var(--bad-bg); color: var(--bad); border: 1px solid #ebceca; }
      ul { margin-top: 6px; }
      code { background: #f2ece4; border: 1px solid #e7dccf; padding: 2px 6px; border-radius: 6px; }
      @media (max-width: 760px){ .row { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <div class="wrap">
      <nav class="nav" aria-label="Primary">
        <a class="active" href="/">Analyzer</a>
        <a href="/dashboard">Dashboard</a>
        <a href="/openapi.yaml" target="_blank" rel="noreferrer">API Spec</a>
        <a href="/docs/onboarding" target="_blank" rel="noreferrer">Onboarding</a>
      </nav>
      <div class="card">
        <h1>AI PR Risk Gate</h1>
        <p>Interactive demo endpoint for your internship portfolio. Paste a sample PR diff and get a risk score.</p>
      </div>

      <div class="card">
        <div class="row">
          <div>
            <label>Repo</label>
            <input id="repo" value="ai-pr-risk-gate" />
          </div>
          <div>
            <label>PR Number</label>
            <input id="pr" type="number" value="1" />
          </div>
        </div>

        <label>Filename</label>
        <input id="file" value="src/auth/jwt.ts" />

        <label>Patch Snippet</label>
        <textarea id="patch">+ const token = sign(payload, secret)</textarea>

        <button id="run">Analyze Risk</button>
      </div>

      <div id="result" class="card" style="display:none;"></div>
    </div>

    <script>
      const result = document.getElementById('result');
      document.getElementById('run').addEventListener('click', async () => {
        const payload = {
          repo: document.getElementById('repo').value,
          prNumber: Number(document.getElementById('pr').value),
          files: [{ filename: document.getElementById('file').value, patch: document.getElementById('patch').value }]
        };

        const res = await fetch('/api/analyze', {
          method: 'POST',
          headers: { 'content-type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const data = await res.json();

        if (!res.ok) {
          result.style.display = 'block';
          result.innerHTML = `<h3>Request failed</h3><p>${data.error || 'Unknown error'}</p>`;
          return;
        }

        result.style.display = 'block';
        result.innerHTML = `
          <h3>Risk Score: ${data.score}/100</h3>
          <p><span class="pill ${data.severity}">${data.severity.toUpperCase()}</span></p>
          <h4>Findings</h4>
          <ul>${data.findings.map(f => `<li>${f}</li>`).join('')}</ul>
          <h4>Recommendations</h4>
          <ul>${data.recommendations.map(r => `<li>${r}</li>`).join('')}</ul>
        `;
      });
    </script>
  </body>
</html>
